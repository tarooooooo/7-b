<div class="container">
  <div class="row">
    <%= render 'users/list',user:@user,book:@book%>
    <div class ="col-md-8 offset-md-1">
      <h2>Book detail</h2>
      <table class="table">
        <therd>
          <tr>
            <th></th>
            <th>Title</th>
            <th>Opinion</th>
            <th colspan=6></th>
          </tr>
      　</therd>
        <tbody>
          <tr>

            <td>
              <%=link_to user_path(@user.id) do %>
              <%= attachment_image_tag @user, :profile_image, size: "40x40", format: 'jpeg', fallback: "no_image.jpg" %><br>
              <%=@user.name %>
              <% end %>
            </td>

            <td>
              <%=link_to book_path(@user_book.id) do%>
              <%=@user_book.title %>
              <% end %>
            </td>

            <td>
              <%= @user_book.body %>
            </td>

            <% if current_user.liked_by?(@user_book.id) %>
              <td>
                <%= link_to "#{@user_book.favorites.count}",book_favorites_path(@user_book), {method: :delete , class:"fas fa-heart"}  %>
              </td>
            <% else %>
              <td>
                <%= link_to "#{@user_book.favorites.count}", book_favorites_path(@user_book), {method: :post , class:"far fa-heart"} %>
              </td>
            <% end %>
            <td class ='example'>
              <span>コメント数：<%= @user_book.book_comments.count %></span>
            </td>
            <% if @user_book.user == current_user %>

            <td>
              <%=link_to edit_book_path(@user_book.id) ,class:"btn btn-sm btn-success" do %>
              Edit
              <% end %>
            </td>

            <td>
              <%=link_to book_path(@user_book.id), method: :delete ,class:"btn btn-sm btn-danger " ,method: :delete, data: {confirm: "本当に消しますか？"}  do%>
              Destroy
              <% end %>
            </td>
            <% end %>

          </tr>
        </tbody>
      </table>
      <h2>Comment</h2>
      <table class="table">
        <tbody>
          <% @book_comments.each do |book_comment| %>
          <tr>

            <td  class ="example">
            <%=link_to user_path(book_comment.user) do %>
              <%= attachment_image_tag book_comment.user, :profile_image, size: "40x40", format: 'jpeg', fallback: "no_image.jpg" %><br>
              <%= book_comment.user.name %>
            <% end %>
            </td>

            <td class ="example">
              <span><%= book_comment.comment_content %></span>
            </td>

            <% if book_comment.user == current_user %>
            <td>
              <%=link_to "Destroy",book_book_comment_path(book_comment.book, book_comment), method: :delete ,class:"btn btn-sm btn-danger " %>
            </td>
            <% end %>

          <% end %>
          </tr>
        </tbody>
      </table>

      <%= form_with model: [@user_book,@book_comment], method: :post do |f| %>
      <div class="form_group">
      <%= f.text_area :comment_content , class:"form-control"%>
      <%= f.hidden_field :book_id, value: @user_book.id %>
      </div>
      <div class="form_group mt-3">
      <%= f.submit "送信" , class:"btn btn-success" %>
      </div>
      <% end %>
    </div>
  </div>
</div>